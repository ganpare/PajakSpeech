# 音声文字起こしアプリケーション (FastAPI + NVIDIA Parakeet ASR)

このアプリケーションは、ユーザーがアップロードした音声ファイル（特にWAVE形式）を、NVIDIA Parakeet ASRモデル（nvidia/parakeet-tdt-0.6b-v2）を使用して文字起こしし、結果を複数の形式で提供するDockerベースのウェブアプリケーションです。

## 機能

- 音声ファイルのアップロードと処理
- バックグラウンドでの文字起こし処理
- 進捗状況のリアルタイム表示
- 発話セグメントごとのタイムスタンプ付き文字起こし結果
- 単語レベルでのタイムスタンプ
- 結果のダウンロード（CSV, SRT, VTT, JSON, LRC形式に対応）
- 音声セグメントの再生機能

## 必要条件

- Docker
- Docker Compose
- （オプション）GPUサポート - NVIDIAドライバとNVIDIA Container Toolkit

## セットアップと実行方法

### 1. リポジトリのクローン

```bash
git clone <リポジトリURL>
cd <リポジトリディレクトリ>
```

### 2. 環境変数の設定

`.env.example`ファイルを`.env`にコピーして、必要に応じて設定を変更します。

```bash
cp .env.example .env
```

### 3. Dockerコンテナのビルドと起動

```bash
docker-compose up --build
```

GPUを使用する場合は、docker-compose.ymlファイル内の`deploy`セクションのコメントを外してから実行してください。

### 4. アプリケーションへのアクセス

ブラウザで以下のURLにアクセスします：

```
http://localhost:5000
```

## 使用方法

1. ホーム画面から「Start Transcribing」ボタンをクリックしてアップロードページに移動します。
2. 「Choose audio file...」ボタンをクリックして音声ファイルを選択します。
3. 「Upload File」ボタンをクリックしてファイルをアップロードします。
4. アップロード完了後、「Start Transcription」ボタンをクリックして文字起こし処理を開始します。
5. 処理が完了すると、結果ページが表示されます。
6. セグメントビューまたは単語ビューで文字起こし結果を確認できます。
7. 各セグメントの再生ボタンをクリックすると、該当部分の音声を再生できます。
8. 「Download Results」セクションから、希望する形式（SRT, VTT, CSV, JSON, LRC）で結果をダウンロードできます。

## 技術スタック

- **バックエンド**: FastAPI (Python)
- **フロントエンド**: HTML, CSS, JavaScript, Bootstrap
- **ASRモデル**: NVIDIA Parakeet TDT (nvidia/parakeet-tdt-0.6b-v2)
- **データベース**: SQLite
- **コンテナ化**: Docker, Docker Compose

## 注意事項

- 処理時間は音声の長さやハードウェア性能（特にGPUの有無）によって大きく変わります。
- GPUを使用すると処理速度が大幅に向上します。
- 大きな音声ファイルの場合、処理に時間がかかることがあります。
- 日本語音声の文字起こしを行う場合は、適切な言語モデルに変更する必要があります。

## トラブルシューティング

- **Error: Unable to find image...** - Dockerイメージのビルドに失敗している可能性があります。`docker-compose build`を実行してみてください。
- **音声ファイルがアップロードできない** - ファイル形式とサイズを確認してください。WAV形式を推奨しています。
- **処理が非常に遅い** - GPUが利用可能か確認してください。CPU処理の場合は大幅に遅くなります。
- **ブラウザが応答しない** - 非常に長い音声ファイルを処理している場合は、しばらく待つか、より短いセグメントに分割してみてください。